# Custom ModSecurity Rules for PHP Web App
SecRuleEngine On

# Disable some false positives for PHP apps
SecRule REQUEST_FILENAME "@endsWith .php" \
    "id:900010,\
     phase:1,\
     pass,\
     nolog,\
     ctl:ruleRemoveById=932100,\
     ctl:ruleRemoveById=932110,\
     ctl:ruleRemoveById=932120"

# Allow common search patterns
SecRule ARGS:search "@rx ^[\w\s\-]+$" \
    "id:900020,\
     phase:2,\
     pass,\
     nolog,\
     ctl:ruleRemoveById=942100"

# File upload security
SecRule FILES "@rx \.(php|phtml|phar|exe|sh|bat)$" \
    "id:900100,\
     phase:2,\
     deny,\
     status:403,\
     log,\
     msg:'Blocked dangerous file extension'"

SecRule FILES_COMBINED_SIZE "@gt 10485760" \
    "id:900110,\
     phase:2,\
     deny,\
     status:413,\
     log,\
     msg:'File too large (max 10MB)'"